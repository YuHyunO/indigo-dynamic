<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
		http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.1.xsd">


    <util:map id="serviceStrategies">
        <entry key="CALL_PROCEDURE_AND_FETCH">
            <list>
                <bean class="mb.dnm.service.db.Select">
                    <property name="output" value="records"/>
                </bean>

                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"  value="records"/>
                </bean>


                <bean class="mb.dnm.service.db.StartTransaction"/>
                <bean class="mb.dnm.service.db.CallProcedure">
                    <property name="input"  value="records"/>
                </bean>

                <bean class="mb.dnm.service.db.Fetch">
                    <property name="output"     value="fetch_result"/>
                </bean>

                <bean class="mb.dnm.service.db.EndTransaction"/>

                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="fetch_result"/>
                    <property name="printToXmlWhenCollectionOrMap"       value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
            </list>
        </entry>

        <entry key="FETCHED_SELECT">
            <list>
                <bean class="mb.dnm.service.db.StartTransaction"/>
                <bean class="mb.dnm.service.db.OpenCursor"/>
                <bean class="mb.dnm.service.general.IterationGroup">
                    <property name="iterateUntilBreak"  value="true"/>
                    <property name="services">
                        <list>
                            <bean class="mb.dnm.service.db.Fetch">
                                <property name="output"     value="fetch_result"/>
                            </bean>
                            <bean class="mb.dnm.service.general.PrintInput">
                                <property name="input"                          value="fetch_result"/>
                                <property name="printToXmlWhenCollectionOrMap"       value="true"/>
                                <property name="indented"                       value="true"/>
                            </bean>
                            <bean class="mb.dnm.service.general.BreakIteration">
                                <property name="input"  value="fetch_result"/>
                            </bean>
                        </list>
                    </property>
                </bean>
                <bean class="mb.dnm.service.db.EndTransaction"/>


            </list>
        </entry>

        <entry key="ITER_TEST">
            <list>
                <bean class="mb.dnm.service.db.StartTransaction"/>
                <bean class="mb.dnm.service.general.IterationGroup">
                    <property name="iterateUntilBreak"  value="true"/>
                    <property name="services">
                        <list>
                            <bean class="mb.dnm.service.db.Select">
                                <property name="output"     value="select_result"/>
                            </bean>
                            <bean class="mb.dnm.service.general.BreakIteration">
                                <property name="input"  value="select_result"/>
                            </bean>
                            <bean class="mb.dnm.service.db.Update">
                                <property name="input"  value="select_result"/>
                            </bean>
                        </list>
                    </property>
                </bean>
                <bean class="mb.dnm.service.db.EndTransaction"/>
            </list>
        </entry>

        <entry key="SIZE_TEST">
            <list>
                <bean class="mb.dnm.service.db.Select">
                    <property name="output"     value="select_list"/>
                </bean>
                <bean class="mb.dnm.service.general.GetSize">
                    <property name="input"      value="select_list"/>
                    <property name="output"     value="select_list_size"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"      value="select_list_size"/>
                </bean>
            </list>
        </entry>


        <entry key="HTTP_TEST">
            <list>
                <bean class="mb.dnm.service.general.TransformData">
                    <property name="input"              value="$http_body"/>
                    <property name="inputDataType"      value="JSON"/>
                    <property name="outputDataType"     value="MAP"/>
                    <property name="output"             value="$http_body"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="$http_body"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
            </list>
        </entry>

        <entry key="CRYPTO_TEST">
            <list>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"              value="$http_body"/>
                </bean>
                <bean class="mb.dnm.service.general.TransformData">
                    <property name="input"              value="$http_body"/>
                    <property name="inputDataType"      value="JSON"/>
                    <property name="outputDataType"     value="MAP"/>
                    <property name="output"             value="$http_body"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="$http_body"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.crypto.Encrypt">
                    <property name="cryptoType"         value="JASYPT"/>
                    <property name="input"              value="$http_body"/>
                    <property name="output"             value="enc_data"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="enc_data"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.crypto.Decrypt">
                    <property name="cryptoType"         value="JASYPT"/>
                    <property name="input"              value="enc_data"/>
                    <property name="output"             value="dec_data"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="dec_data"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
            </list>
        </entry>

        <entry key="HTTP_TEMPLATE_TEST">
            <list>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"              value="$http_body"/>
                </bean>
                <bean class="mb.dnm.service.general.TransformData">
                    <property name="input"              value="$http_body"/>
                    <property name="inputDataType"      value="JSON"/>
                    <property name="outputDataType"     value="MAP"/>
                    <property name="output"             value="$http_body"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="$http_body"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.crypto.Encrypt">
                    <property name="cryptoType"         value="JASYPT"/>
                    <property name="input"              value="$http_body"/>
                    <property name="output"             value="enc_data"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="enc_data"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.crypto.Decrypt">
                    <property name="description"        value="로그로 적재할 데이터를 복호화"/>
                    <property name="cryptoType"         value="JASYPT"/>
                    <property name="input"              value="enc_data"/>
                    <property name="output"             value="dec_data"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="dec_data"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.http.SetHttpResponseBody">
                    <property name="input"      value="dec_data"/>
                </bean>
            </list>
        </entry>


        <entry key="DYNAMIC_TEST">
            <list>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"              value="$http_body"/>
                </bean>

                <bean class="mb.dnm.service.general.TransformData">
                    <property name="input"              value="$http_body"/>
                    <property name="inputDataType"      value="JSON"/>
                    <property name="outputDataType"     value="MAP"/>
                    <property name="output"             value="$http_body"/>
                </bean>

                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="$http_body"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>

                <bean class="mb.dnm.service.dynamic.ExecuteDynamicCode"/>

                <bean class="mb.dnm.service.dynamic.ExecuteDynamicCode"/>

                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="dynamic_result"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
            </list>
        </entry>


        <entry key="CRYPTO_GEN">
            <list>
                <bean class="mb.dnm.service.general.OutputCustomData">
                    <property name="customData" value="5uIW8zL0AmVQN9xdP7GoWPlsl7115asdqwDWEHd3RsT2fDA1yNcG4AyBbKdJMiC"/>
                    <property name="output"         value="data"/>
                </bean>
                <bean class="mb.dnm.service.crypto.Encrypt">
                    <property name="input"  value="data"/>
                    <property name="output"  value="encrypted"/>
                </bean>
                <bean class="mb.dnm.service.general.TransformData">
                    <property name="input"              value="encrypted"/>
                    <property name="inputDataType"      value="BYTE_ARRAY"/>
                    <property name="outputDataType"     value="STRING"/>
                    <property name="output"             value="key"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="key"/>
                </bean>
            </list>
        </entry>

        <entry key="INTERFACE_ACTIVATION">
            <list>
                <bean class="mb.dnm.service.general.TransformData">
                    <property name="input"              value="$http_body"/>
                    <property name="inputDataType"      value="JSON"/>
                    <property name="outputDataType"     value="MAP"/>
                    <property name="output"             value="$http_body"/>
                </bean>
                <bean class="mb.dnm.service.general.ControlInterfaceActivation">
                    <property name="input"              value="$http_body"/>
                </bean>
                <bean class="mb.dnm.service.http.SetHttpResponseBody">
                    <property name="input"      value="$$COMMAND_RESULT"/>
                </bean>
            </list>
        </entry>

        <entry key="DB_SERVICE_SAMPLE">
            <list>
                <bean class="mb.dnm.service.db.StartTransaction"/>
                <bean class="mb.dnm.service.db.Update">
                    <property name="description"     value="DB의 데이터를 먼저 UPDATE 한다."/>
                </bean>
                <bean class="mb.dnm.service.db.Select">
                    <property name="description"     value="UPDATE 한 데이터를 SELECT 한다."/>
                    <property name="output"          value="select_result"/>
                </bean>
                <bean class="mb.dnm.service.general.GetSize">
                    <property name="description"     value="SELECT 한 데이터의 크기를 구한다."/>
                    <property name="input"      value="select_result"/>
                    <property name="output"     value="tx_count"/>
                </bean>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="description"     value="SELECT 결과가 없으면 프로세스를 종료한다.."/>
                    <property name="input"              value="tx_count"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="description"    value="SELECT 결과를 출력한다."/>
                    <property name="input"                          value="select_result"/>
                    <property name="printToXmlWhenCollectionOrMap"  value="true"/>
                </bean>
                <bean class="mb.dnm.service.db.EndTransaction"/>
            </list>
        </entry>


        <entry key="FILE_MOVEMENT">
            <list>
                <bean class="mb.dnm.service.file.ListFiles">
                    <property name="sourceAlias"                    value="SRC"/>
                    <property name="output"                         value="local_file_list"/>
                    <property name="createDirectoriesWhenNotExist"  value="false"/>
                    <property name="searchRecursively"              value="true"/>
                </bean>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"                          value="local_file_list"/>
                </bean>
                <bean class="mb.dnm.service.file.MoveFiles">
                    <property name="sourceAlias"                    value="SRC"/>
                    <property name="input"                          value="local_file_list"/>
                    <property name="directoryType"                  value="LOCAL_SUCCESS"/>
                    <property name="debuggingWhenMoved"             value="false"/>
                    <property name="ignoreErrorFile"                value="true"/>
                    <property name="output"                         value="moved_files"/>
                    <property name="errorOutput"                    value="error_files"/>
                </bean>
            </list>
        </entry>
    </util:map>



</beans>