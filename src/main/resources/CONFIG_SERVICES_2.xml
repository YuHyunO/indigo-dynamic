<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
		http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.1.xsd">


    <util:map id="serviceStrategies">

        <entry key="CALL_PROCEDURE_AND_FETCH">
            <list>
                <bean class="mb.dnm.service.db.Select">
                    <description>Source DB 에서 연계 대상 데이터를 조회한다.</description>
                    <property name="input"              value=""/>
                    <property name="output"             value="data_list"/>
                </bean>

                <bean class="mb.dnm.service.db.Select">
                    <property name="output" value="records"/>
                </bean>

                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"  value="records"/>
                </bean>


                <bean class="mb.dnm.service.db.StartTransaction"/>
                <bean class="mb.dnm.service.db.CallProcedure">
                    <property name="input"  value="records"/>
                </bean>

                <bean class="mb.dnm.service.db.Fetch">
                    <property name="output"     value="fetch_result"/>
                </bean>

                <bean class="mb.dnm.service.db.EndTransaction"/>

                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="fetch_result"/>
                    <property name="printToXmlWhenCollectionOrMap"       value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
            </list>
        </entry>

        <entry key="FETCHED_SELECT">
            <list>
                <bean class="mb.dnm.service.db.StartTransaction"/>
                <bean class="mb.dnm.service.db.OpenCursor"/>
                <bean class="mb.dnm.service.general.IterationGroup">
                    <property name="iterateUntilBreak"  value="true"/>
                    <property name="services">
                        <list>
                            <bean class="mb.dnm.service.db.Fetch">
                                <property name="output"     value="fetch_result"/>
                            </bean>
                            <bean class="mb.dnm.service.general.PrintInput">
                                <property name="input"                          value="fetch_result"/>
                                <property name="printToXmlWhenCollectionOrMap"       value="true"/>
                                <property name="indented"                       value="true"/>
                            </bean>
                            <bean class="mb.dnm.service.general.BreakIteration">
                                <property name="input"  value="fetch_result"/>
                            </bean>
                        </list>
                    </property>
                </bean>
                <bean class="mb.dnm.service.db.EndTransaction"/>


            </list>
        </entry>

        <entry key="ITER_TEST">
            <list>
                <bean class="mb.dnm.service.db.StartTransaction"/>
                <bean class="mb.dnm.service.general.IterationGroup">
                    <property name="iterateUntilBreak"  value="true"/>
                    <property name="services">
                        <list>
                            <bean class="mb.dnm.service.db.Select">
                                <property name="output"     value="select_result"/>
                            </bean>
                            <bean class="mb.dnm.service.general.BreakIteration">
                                <property name="input"  value="select_result"/>
                            </bean>
                            <bean class="mb.dnm.service.db.Update">
                                <property name="input"  value="select_result"/>
                            </bean>
                        </list>
                    </property>
                </bean>
                <bean class="mb.dnm.service.db.EndTransaction"/>
            </list>
        </entry>

        <entry key="SIZE_TEST">
            <list>
                <bean class="mb.dnm.service.db.Select">
                    <property name="output"     value="select_list"/>
                </bean>
                <bean class="mb.dnm.service.general.GetSize">
                    <property name="input"      value="select_list"/>
                    <property name="output"     value="select_list_size"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"      value="select_list_size"/>
                </bean>
            </list>
        </entry>


        <entry key="HTTP_TEST">
            <list>
                <bean class="mb.dnm.service.general.TransformData">
                    <property name="input"              value="$http_body"/>
                    <property name="inputDataType"      value="JSON"/>
                    <property name="outputDataType"     value="MAP"/>
                    <property name="output"             value="$http_body"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="$http_body"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
            </list>
        </entry>

        <entry key="CRYPTO_TEST">
            <list>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"              value="$http_body"/>
                </bean>
                <bean class="mb.dnm.service.general.TransformData">
                    <property name="input"              value="$http_body"/>
                    <property name="inputDataType"      value="JSON"/>
                    <property name="outputDataType"     value="MAP"/>
                    <property name="output"             value="$http_body"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="$http_body"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.crypto.Encrypt">
                    <property name="cryptoType"         value="JASYPT"/>
                    <property name="input"              value="$http_body"/>
                    <property name="output"             value="enc_data"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="enc_data"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.crypto.Decrypt">
                    <property name="cryptoType"         value="JASYPT"/>
                    <property name="input"              value="enc_data"/>
                    <property name="output"             value="dec_data"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="dec_data"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
            </list>
        </entry>

        <entry key="HTTP_TEMPLATE_TEST">
            <list>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"              value="$http_body"/>
                </bean>
                <bean class="mb.dnm.service.general.TransformData">
                    <property name="input"              value="$http_body"/>
                    <property name="inputDataType"      value="JSON"/>
                    <property name="outputDataType"     value="MAP"/>
                    <property name="output"             value="$http_body"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="$http_body"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.crypto.Encrypt">
                    <property name="cryptoType"         value="JASYPT"/>
                    <property name="input"              value="$http_body"/>
                    <property name="output"             value="enc_data"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="enc_data"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.crypto.Decrypt">
                    <property name="description"        value="로그로 적재할 데이터를 복호화"/>
                    <property name="cryptoType"         value="JASYPT"/>
                    <property name="input"              value="enc_data"/>
                    <property name="output"             value="dec_data"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="dec_data"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.http.SetHttpResponseBody">
                    <property name="input"      value="dec_data"/>
                </bean>
            </list>
        </entry>


        <entry key="DYNAMIC_TEST">
            <list>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"              value="$http_body"/>
                </bean>

                <bean class="mb.dnm.service.general.TransformData">
                    <property name="input"              value="$http_body"/>
                    <property name="inputDataType"      value="JSON"/>
                    <property name="outputDataType"     value="MAP"/>
                    <property name="output"             value="$http_body"/>
                </bean>

                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="$http_body"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>

                <bean class="mb.dnm.service.dynamic.ExecuteDynamicCode"/>

                <bean class="mb.dnm.service.dynamic.ExecuteDynamicCode"/>

                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="dynamic_result"/>
                    <property name="printToJsonWhenCollectionOrMap" value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
            </list>
        </entry>


        <entry key="CRYPTO_GEN">
            <list>
                <bean class="mb.dnm.service.general.OutputCustomData">
                    <property name="customData" value="5uIW8zL0AmVQN9xdP7GoWPlsl7115asdqwDWEHd3RsT2fDA1yNcG4AyBbKdJMiC"/>
                    <property name="output"         value="data"/>
                </bean>
                <bean class="mb.dnm.service.crypto.Encrypt">
                    <property name="input"  value="data"/>
                    <property name="output"  value="encrypted"/>
                </bean>
                <bean class="mb.dnm.service.general.TransformData">
                    <property name="input"              value="encrypted"/>
                    <property name="inputDataType"      value="BYTE_ARRAY"/>
                    <property name="outputDataType"     value="STRING"/>
                    <property name="output"             value="key"/>
                </bean>
                <bean class="mb.dnm.service.general.ThrowException"/>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="key"/>
                </bean>
            </list>
        </entry>

        <entry key="INTERFACE_ACTIVATION">
            <list>
                <bean class="mb.dnm.service.general.TransformData">
                    <property name="input"              value="$http_body"/>
                    <property name="inputDataType"      value="JSON"/>
                    <property name="outputDataType"     value="MAP"/>
                    <property name="output"             value="$http_body"/>
                </bean>
                <bean class="mb.dnm.service.general.ControlInterfaceActivation">
                    <property name="input"              value="$http_body"/>
                </bean>
                <bean class="mb.dnm.service.http.SetHttpResponseBody">
                    <property name="input"      value="$$COMMAND_RESULT"/>
                </bean>
            </list>
        </entry>

        <entry key="DB_SERVICE_SAMPLE">
            <list>
                <bean class="mb.dnm.service.db.StartTransaction"/>
                <bean class="mb.dnm.service.db.Update">
                    <property name="description"     value="DB의 데이터를 먼저 UPDATE 한다."/>
                </bean>
                <bean class="mb.dnm.service.db.Select">
                    <property name="description"     value="UPDATE 한 데이터를 SELECT 한다."/>
                    <property name="output"          value="select_result"/>
                </bean>
                <bean class="mb.dnm.service.general.GetSize">
                    <property name="description"     value="SELECT 한 데이터의 크기를 구한다."/>
                    <property name="input"      value="select_result"/>
                    <property name="output"     value="tx_count"/>
                </bean>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="description"     value="SELECT 결과가 없으면 프로세스를 종료한다.."/>
                    <property name="input"              value="tx_count"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="description"    value="SELECT 결과를 출력한다."/>
                    <property name="input"                          value="select_result"/>
                    <property name="printToXmlWhenCollectionOrMap"  value="true"/>
                </bean>
                <bean class="mb.dnm.service.db.EndTransaction"/>
            </list>
        </entry>


        <entry key="FILE_MOVEMENT">
            <list>
                <bean class="mb.dnm.service.file.ListFiles">
                    <property name="sourceAlias"                    value="SRC"/>
                    <property name="output"                         value="local_file_list"/>
                    <property name="createDirectoriesWhenNotExist"  value="false"/>
                    <property name="searchRecursively"              value="true"/>
                </bean>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"                          value="local_file_list"/>
                </bean>
                <bean class="mb.dnm.service.file.MoveFiles">
                    <property name="sourceAlias"                    value="SRC"/>
                    <property name="input"                          value="local_file_list"/>
                    <property name="directoryType"                  value="LOCAL_SUCCESS"/>
                    <property name="debuggingWhenMoved"             value="false"/>
                    <property name="ignoreErrorFile"                value="true"/>
                    <property name="output"                         value="moved_files"/>
                    <property name="errorOutput"                    value="error_files"/>
                </bean>
            </list>
        </entry>

        <entry key="$P_DB2DB_master_detail_2:1">
            <!--            <description>DB to DB 서비스[마스터디테일(2:1)]</description>-->
            <list>
                <bean class="mb.dnm.service.db.StartTransaction"/>
                <bean class="mb.dnm.service.db.Select">
                    <description>Source DB 에서 연계 대상 데이터를 조회한다.</description>
                    <property name="output"             value="master_data_list"/>
                </bean>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <description>연계 대상 파일이 없으면 프로세스를 종료한다.</description>
                    <property name="input"              value="master_data_list"/>
                    <property name="output"             value="no_logging_flag"/>
                    <property name="outputValue"        value="Y"/>
                </bean>
                <bean class="mb.dnm.service.general.GetSize">
                    <description>Master 데이터의 개수를 확인한다.</description>
                    <property name="input"      		value="master_data_list"/>
                    <property name="output"     		value="tx_count"/>
                </bean>
                <bean class="mb.dnm.service.general.IterationGroup">
                    <description>Master 데이터의 수만큼 Detail 데이터를 추출하여 수신 DB에 데이터를 적재한다.</description>
                    <property name="input"                                  value="master_data_list"/>
                    <property name="iterationInputName"                     value="master_data"/>
                    <property name="fetchSize"                              value="1"/>
                    <property name="services">
                        <description>연계대상파일의 수만큼 아래에 정의된 프로세스를 순서대로 반복</description>
                        <list>
                            <bean class="mb.dnm.service.db.Select">
                                <property name="description"                value="Detail 데이터를 조회한다."/>
                                <property name="input"                      value="master_data"/>
                                <property name="output"                     value="detail_data"/>
                            </bean>
                            <bean class="mb.dnm.service.dynamic.ExecuteDynamicCode">
                                <description>Master data 와 Detail data 를 Mapping 한 후 insert_data 를 output 한다.</description>
                            </bean>
                            <bean class="mb.dnm.service.db.Insert">
                                <property name="description"        value="Target DB 에 데이터를 Insert 한다."/>
                                <property name="input"              value="insert_data"/>
                            </bean>
                        </list>
                    </property>
                </bean>
                <bean class="mb.dnm.service.db.Update">
                    <property name="description"        value="Source DB 에 처리결과를 Update 한다."/>
                    <property name="input"              value="master_data_list"/>
                </bean>
                <bean class="mb.dnm.service.db.Commit"/>
            </list>
        </entry>

        <entry key="$P_DB2DB_large">
            <!--<description>DB to DB[대용량]</description>-->
            <list>
                <bean class="mb.dnm.service.db.Select">
                    <description>Source DB 에서 연계 대상 데이터 존재여부를 조회한다.</description>
                    <property name="output"             value="data_list"/>
                </bean>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <description>연계 대상 파일이 없으면 프로세스를 종료한다.</description>
                    <property name="input"              value="data_list"/>
                    <property name="output"             value="no_logging_flag"/>
                    <property name="outputValue"        value="Y"/>
                </bean>
                <bean class="mb.dnm.service.db.StartTransaction"/>
                <bean class="mb.dnm.service.db.Select">
                    <description>Source DB 에서 연계 대상 데이터를 fetchSize 만큼씩 조회하여 처리한다.</description>
                    <property name="output"             value="total_fetched_count"/>
                    <property name="handleResultSet"    value="true"/>
                    <property name="resultHandlingSupportFactory">
                        <bean class="mb.dnm.access.db.ResultHandlingSupportFactory">
                            <property name="fetchedInputName"   value="fetched_rows"/>
                            <property name="fetchSize"          value="1000"/>
                            <property name="resultHandlingProcessor">
                                <bean class="mb.dnm.service.general.IterationGroup">
                                    <property name="services">
                                        <description>데이터가 모두 조회될 때까지 아래의 프로세스를 반복</description>
                                        <list>
                                            <bean class="mb.dnm.service.db.Insert">
                                                <property name="description"        value="Target DB 에 데이터를 Insert 한다."/>
                                                <property name="input"              value="fetched_rows"/>
                                            </bean>
                                            <bean class="mb.dnm.service.db.Update">
                                                <property name="description"        value="Source DB 에 처리결과를 Update 한다."/>
                                                <property name="input"              value="fetched_rows"/>
                                            </bean>
                                        </list>
                                    </property>
                                </bean>
                            </property>
                        </bean>
                    </property>
                </bean>
                <bean class="mb.dnm.service.db.EndTransaction"/>
            </list>
        </entry>

    </util:map>



</beans>