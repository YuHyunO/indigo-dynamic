<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
		http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.1.xsd">
    <import resource="service_2.xml"/>
    <import resource="service_3.xml"/>


    <util:map id="serviceStrategies">
        <entry key="service_2"  value-ref="service_2"/>
        <entry key="service_3"  value-ref="service_3"/>

        <entry key="DB_WORKING_NO_GROUP_TX">
            <list>
                <bean class="mb.dnm.service.db.Select">
                    <property name="output" value="Data"/>
                </bean>
                <bean class="mb.dnm.service.db.Insert">
                    <property name="input" value="Data"/>
                </bean>
                <bean class="mb.dnm.service.db.Update">
                    <property name="input" value="Data"/>
                </bean>
            </list>
        </entry>

        <entry key="DB_WORKING_IN_GROUP_TX">
            <list>
                <bean class="mb.dnm.service.db.Select"><!-- 송신 테이블 1번에서 데이터 조회 -->
                    <property name="output" value="Data1"/>
                </bean>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty"><!-- 송신 테이블 1번의 데이터가 없으면 연계 프로세스 중지 -->
                    <property name="input"                          value="Data1"/>
                </bean>
                <bean class="mb.dnm.service.db.Select"><!-- 송신 테이블 1번의 조회 결과로 송신 테이블 2번에서 데이터 조회 -->
                    <property name="input"  value="Data1"/>
                    <property name="output" value="Data2"/>
                </bean>
                <bean class="mb.dnm.service.db.StartTransaction"/><!-- 트랜잭션 그룹 시작 -->
                <bean class="mb.dnm.service.db.Insert"><!-- 수신 테이블 1번에 송신 테이블 1번 데이터를 Insert -->
                    <property name="input" value="Data1"/>
                </bean>
                <bean class="mb.dnm.service.db.Insert"><!-- 수신 테이블 2번에 송신 테이블 2번 데이터를 Insert -->
                    <property name="input" value="Data2"/>
                </bean>
                <bean class="mb.dnm.service.db.Update"><!-- 송신 테이블 1번의 데이터를 결과 업데이트 -->
                    <property name="input" value="Data1"/>
                </bean>
                <!--<bean class="mb.dnm.service.general.ThrowException"/>--> <!-- 예외 발생 시 전부 rollback 확인 완료 -->
                <bean class="mb.dnm.service.db.EndTransaction"/><!-- 트랜잭션 그룹 시작 -->
            </list>
        </entry>

        <entry key="FTP_WORKING">
            <list>
                <bean class="mb.dnm.service.ftp.FTPLogin">
                    <property name="sourceAlias"    value="SRC"/>
                </bean>
                <bean class="mb.dnm.service.ftp.FTPLogin">
                    <property name="sourceAlias"    value="TGT"/>
                </bean>
                <bean class="mb.dnm.service.ftp.ListFiles">
                    <property name="sourceAlias"    value="SRC"/>
                    <property name="output"         value="file_list"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"          value="file_list"/>
                </bean>
                <bean class="mb.dnm.service.ftp.DownloadFiles">
                    <property name="sourceAlias"        value="TGT"/>
                    <property name="input"              value="file_list"/>
                    <property name="downloadType"       value="FILE"/>
                    <property name="directoryType"      value="LOCAL_RECEIVE"/>
                </bean>
            </list>
        </entry>

        <entry key="FTP_WORKING2">
            <list>
                <bean class="mb.dnm.service.ftp.FTPLogin">
                    <property name="sourceAlias"    value="SRC"/>
                </bean>
                <bean class="mb.dnm.service.ftp.FTPLogin">
                    <property name="sourceAlias"    value="TGT"/>
                </bean>
                <bean class="mb.dnm.service.general.OutputCustomData">
                    <property name="output"     value="fileName"/>
                    <property name="customData" value="/2025학년도 봄학기 입학 1차 대학원 신입생 모집요강_0708.pdf"/>
                </bean>
                <bean class="mb.dnm.service.ftp.DownloadFiles">
                    <property name="sourceAlias"        value="TGT"/>
                    <property name="input"              value="fileName"/>
                    <property name="downloadType"       value="FILE"/>
                    <property name="directoryType"      value="LOCAL_RECEIVE"/>
                </bean>
            </list>
        </entry>

        <entry key="FTP_LIST">
            <list>
                <bean class="mb.dnm.service.ftp.FTPLogin">
                    <property name="sourceAlias"    value="SRC"/>
                </bean>
                <bean class="mb.dnm.service.ftp.ListFiles">
                    <property name="sourceAlias"        value="SRC"/>
                    <property name="output"             value="file_list"/>
                    <property name="searchRecursively"  value="true"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                      value="file_list"/>
                    <property name="printToJsonWhenCollection"  value="true"/>
                    <property name="indented"                   value="true"/>
                </bean>
            </list>
        </entry>

        <entry key="FTP_DOWNLOAD">
            <list>
                <!--<bean class="mb.dnm.service.ftp.FTPLogin">
                    <property name="sourceAlias"    value="SRC"/>
                </bean>-->
                <bean class="mb.dnm.service.ftp.ListFiles">
                    <property name="sourceAlias"        value="SRC"/>
                    <property name="output"             value="file_list"/>
                    <property name="searchRecursively"  value="true"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                      value="file_list"/>
                    <property name="printToXmlWhenCollection"   value="true"/>
                    <property name="indented"                   value="true"/>
                </bean>
                <bean class="mb.dnm.service.ftp.DownloadFiles">
                    <property name="sourceAlias"        value="SRC"/>
                    <property name="input"              value="file_list"/>
                    <property name="output"             value="local_file_list"/>
                    <property name="downloadType"       value="BYTE_ARRAY"/>
                    <property name="directoryType"      value="LOCAL_RECEIVE"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                      value="local_file_list"/>
                    <property name="printToXmlWhenCollection"   value="false"/>
                    <property name="indented"                   value="true"/>
                </bean>
            </list>
        </entry>

        <entry key="FTP_DOWNLOAD_CUSTOM">
            <list>
                <bean class="mb.dnm.service.ftp.FTPLogin">
                    <property name="sourceAlias"    value="SRC"/>
                </bean>
                <bean class="mb.dnm.service.general.OutputCustomData">
                    <property name="output"             value="file_list"/>
                    <property name="customData">
                        <list>
                            <value>/test/inner/새 텍스트 문서.txt</value>
                            <!--<value>/app.js</value>
                            <value>/brochure_0_1684730334.pdf</value>
                            <value>/DWLX_IF_1.AN1_인터페이스목록_V.1.0.xlsx</value>
                            <value>/테스트.txt</value>-->
                        </list>
                    </property>
                </bean>
                <bean class="mb.dnm.service.ftp.DownloadFiles">
                    <property name="sourceAlias"        value="SRC"/>
                    <property name="input"              value="file_list"/>
                    <property name="output"             value="local_file_list"/>
                    <property name="downloadType"       value="FILE"/>
                    <property name="directoryType"      value="LOCAL_RECEIVE"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                      value="local_file_list"/>
                    <property name="printToXmlWhenCollection"   value="true"/>
                    <property name="indented"                   value="true"/>
                </bean>
            </list>
        </entry>

        <entry key="FILE_LIST">
            <list>
                <bean class="mb.dnm.service.file.ListFiles">
                    <property name="sourceAlias"                    value="SRC"/>
                    <property name="output"                         value="local_file_list"/>
                    <property name="createDirectoriesWhenNotExist"  value="true"/>
                    <property name="searchRecursively"              value="true"/>
                </bean>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"                          value="local_file_list"/>
                </bean>
                <!--<bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="local_file_list"/>
                    <property name="printToXmlWhenCollection"       value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>-->
                <bean class="mb.dnm.service.file.MoveFiles">
                    <property name="sourceAlias"                    value="SRC"/>
                    <property name="input"                          value="local_file_list"/>
                    <property name="directoryType"                  value="LOCAL_SUCCESS"/>
                    <property name="debuggingWhenMoved"             value="false"/>
                    <property name="ignoreErrorFile"                value="true"/>
                    <property name="output"                         value="moved_files"/>
                    <property name="errorOutput"                    value="error_files"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="moved_files"/>
                    <property name="printToXmlWhenCollection"       value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="error_files"/>
                    <property name="printToXmlWhenCollection"       value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
            </list>
        </entry>

        <entry key="FILE_COPY">
            <list>
                <bean class="mb.dnm.service.file.ListFiles">
                    <property name="sourceAlias"                    value="SRC"/>
                    <property name="directoryType"                  value="LOCAL_SEND"/>
                    <property name="createDirectoriesWhenNotExist"  value="true"/>
                    <property name="searchRecursively"              value="true"/>
                    <property name="output"                         value="file_list"/>
                </bean>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"                          value="file_list"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="file_list"/>
                    <property name="printToXmlWhenCollection"       value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.file.CopyFiles">
                    <property name="sourceAlias"                    value="SRC"/>
                    <property name="input"                          value="file_list"/>
                    <property name="directoryType"                  value="LOCAL_COPY"/>
                    <property name="output"                         value="copied_list"/>
                    <property name="errorOutput"                    value="error_list"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="copied_list"/>
                    <property name="printToXmlWhenCollection"       value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
            </list>
        </entry>

        <entry key="FTP_MOVE">
            <list>
                <!--<bean class="mb.dnm.service.ftp.ListFiles">
                    <property name="sourceAlias"        value="SRC"/>
                    <property name="directoryType"      value="REMOTE_SEND"/>
                    <property name="output"             value="old_paths"/>
                </bean>-->
                <bean class="mb.dnm.service.general.OutputCustomData">
                    <property name="customData">
                        <set>
                            <value>/send/초급영문법/</value>
                        </set>
                    </property>
                    <property name="output"                         value="old_paths"/>
                </bean>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"                          value="old_paths"/>
                </bean>
                <bean class="mb.dnm.service.general.PauseProcess">
                    <property name="millisecond"                    value="5000"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="old_paths"/>
                    <property name="printToXmlWhenCollection"       value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.ftp.MoveFiles">
                    <property name="sourceAlias"                    value="SRC"/>
                    <property name="input"                          value="old_paths"/>
                    <property name="debuggingWhenMoved"             value="true"/>
                    <property name="output"                         value="moved_path"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="moved_path"/>
                    <property name="printToXmlWhenCollection"       value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
            </list>
        </entry>

        <entry key="FILE_DELETE">
            <list>
                <bean class="mb.dnm.service.file.ListFiles">
                    <property name="sourceAlias"                    value="SRC"/>
                    <property name="directoryType"                  value="LOCAL_BACKUP"/>
                    <property name="createDirectoriesWhenNotExist"  value="true"/>
                    <property name="searchRecursively"              value="true"/>
                    <property name="output"                         value="file_list"/>
                </bean>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"                          value="file_list"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="file_list"/>
                    <property name="printToXmlWhenCollection"       value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.file.DeleteFiles">
                    <property name="input"                          value="file_list"/>
                    <property name="output"                         value="deleted_list"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="deleted_list"/>
                    <property name="printToXmlWhenCollection"       value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
            </list>
        </entry>

        <entry key="FTP_DELETE">
            <list>
                <bean class="mb.dnm.service.ftp.ListFiles">
                    <property name="sourceAlias"                    value="SRC"/>
                    <property name="searchRecursively"              value="true"/>
                    <property name="directoryType"                  value="REMOTE_BACKUP"/>
                    <property name="createDirectoriesWhenNotExist"  value="true"/>
                    <property name="output"                         value="file_list"/>
                </bean>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"                          value="file_list"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="file_list"/>
                    <property name="printToXmlWhenCollection"       value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.ftp.DeleteFiles">
                    <property name="sourceAlias"            value="SRC"/>
                    <property name="input"                  value="file_list"/>
                </bean>
            </list>
        </entry>

        <entry key="FTP_UPLOAD">
            <list>
                <bean class="mb.dnm.service.file.ListFiles">
                    <property name="sourceAlias"                    value="SRC"/>
                    <property name="searchRecursively"              value="true"/>
                    <property name="directoryType"                  value="LOCAL_BACKUP"/>
                    <property name="createDirectoriesWhenNotExist"  value="true"/>
                    <property name="output"                         value="file_list"/>
                </bean>
                <bean class="mb.dnm.service.general.StopIfInputIsNullOrEmpty">
                    <property name="input"                          value="file_list"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="file_list"/>
                    <property name="printToXmlWhenCollection"       value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
                <bean class="mb.dnm.service.ftp.UploadFiles">
                    <property name="sourceAlias"                    value="TGT"/>
                    <property name="input"                          value="file_list"/>
                    <property name="output"                         value="uploaded_list"/>
                    <property name="directoryType"                  value="REMOTE_RECEIVE"/>
                </bean>
                <bean class="mb.dnm.service.file.MoveFiles">
                    <property name="sourceAlias"                    value="SRC"/>
                    <property name="input"                          value="uploaded_list"/>
                    <property name="directoryType"                  value="LOCAL_SUCCESS"/>
                </bean>
                <bean class="mb.dnm.service.general.PrintInput">
                    <property name="input"                          value="uploaded_list"/>
                    <property name="printToXmlWhenCollection"       value="true"/>
                    <property name="indented"                       value="true"/>
                </bean>
            </list>
        </entry>

        <entry key="FILE_WRITE">
            <list>
                <bean class="mb.dnm.service.db.Select">
                    <property name="output" value="Data"/>
                </bean>

            </list>
        </entry>
    </util:map>


</beans>